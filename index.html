<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test - Admin</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

  
    <link href="img/favicon.ico" rel="icon">


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">

 
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

   
    <link href="css/bootstrap.min.css" rel="stylesheet">


    <link href="css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<style>
  html, body {
  height: 100%;
  margin: 0;
  overflow: hidden; /* üî• ‡∏õ‡∏¥‡∏î scroll ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
}
    .header {
        display: flex;
        width: 100%;
       justify-content: space-between;
    }

    .nav-link svg {
  margin-right: 8px;
  display: inline-block;
}

.app-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
}

.app-header {
  flex: 0 0 auto;
  padding: 10px 20px;
  background: #f8f9fa;
}

.app-content {
  flex: 1 1 auto;
  overflow: hidden; /* ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô */
  padding: 10px 20px;
  display: flex;
  flex-direction: column;
}

.app-footer {
  flex: 0 0 auto;
  padding: 10px;
}

.table-wrapper {
  flex: 1;
  overflow-y: auto;  /* üî• Scroll ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
  overflow-x: auto;
  border: 1px solid #ddd;
}

thead th {
  position: sticky;
  top: 0;
  background: white;
  z-index: 2;
}

/* Tablet ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô 8-10 ‡∏ô‡∏¥‡πâ‡∏ß */
@media (min-width: 900px) and (max-width: 1280px) {

  body {
    font-size: 16px;
  }

  .container {
    max-width: 100%;
    padding: 20px 30px;
  }

  /* ‡πÄ‡∏°‡∏ô‡∏π */
  .nav-link {
    font-size: 16px;
    padding: 10px 14px;
  }

  /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
  table {
    font-size: 14px;
  }

  th, td {
    padding: 6px;
  }

  /* ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
  input, textarea, select {
    font-size: 16px;
    padding: 6px;
  }

  /* ‡∏õ‡∏∏‡πà‡∏° */
  button {
    font-size: 16px;
    padding: 10px 18px;
  }

}

.app-layout {
  display: flex;
}

.sidebar {
  width: 220px;
}

.content {
  flex: 1;
  padding: 20px;
}

@media (min-width: 900px) {
  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
}

@media (min-width: 900px) and (max-width: 1280px) {
  table {
    table-layout: fixed;
    width: 100%;
  }
}
</style>

<body>
    <div class="container-fluid position-relative bg-white d-flex p-0">
     
        <div id="spinner"
            class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <!-- Spinner End -->


        <!-- Sidebar Start -->
        <div class="sidebar pe-4 pb-3">
            <nav class="navbar bg-light navbar-light">
                <a href="index.html" class="navbar-brand mx-4 mb-3">
                    <h3 class="text-primary"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hospital-fill" viewBox="0 0 16 16">
  <path d="M6 0a1 1 0 0 0-1 1v1a1 1 0 0 0-1 1v4H1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h6v-2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5V16h6a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1h-3V3a1 1 0 0 0-1-1V1a1 1 0 0 0-1-1zm2.5 5.034v1.1l.953-.55.5.867L9 7l.953.55-.5.866-.953-.55v1.1h-1v-1.1l-.953.55-.5-.866L7 7l-.953-.55.5-.866.953.55v-1.1zM2.25 9h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5A.25.25 0 0 1 2 9.75v-.5A.25.25 0 0 1 2.25 9m0 2h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5a.25.25 0 0 1 .25-.25M2 13.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25zM13.25 9h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5a.25.25 0 0 1 .25-.25M13 11.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25zm.25 1.75h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5a.25.25 0 0 1 .25-.25"/>
</svg>Check Up</h3>
                </a>
                <div class="d-flex align-items-center ms-4 mb-4">
                    <div class="position-relative">
                        <img class="rounded-circle" src="" alt="" style="width: 40px; height: 40px;">
                        <div
                            class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1">
                        </div>
                    </div>
                    <div class="ms-3">
                        <h6 class="mb-0">Name</h6>
                        <span>Admin</span>
                    </div>
                </div>
                <div class="navbar-nav w-100">
     <a href="index.html" class="nav-item nav-link active"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lungs-fill" viewBox="0 0 16 16">
  <path d="M8 1a.5.5 0 0 1 .5.5v5.243L9 7.1V4.72C9 3.77 9.77 3 10.72 3c.524 0 1.023.27 1.443.592.431.332.847.773 1.216 1.229.736.908 1.347 1.946 1.58 2.48.176.405.393 1.16.556 2.011.165.857.283 1.857.24 2.759-.04.867-.232 1.79-.837 2.33-.67.6-1.622.556-2.741-.004l-1.795-.897A2.5 2.5 0 0 1 9 11.264V8.329l-1-.715-1 .715V7.214c-.1 0-.202.03-.29.093l-2.5 1.786a.5.5 0 1 0 .58.814L7 8.329v2.935A2.5 2.5 0 0 1 5.618 13.5l-1.795.897c-1.12.56-2.07.603-2.741.004-.605-.54-.798-1.463-.838-2.33-.042-.902.076-1.902.24-2.759.164-.852.38-1.606.558-2.012.232-.533.843-1.571 1.579-2.479.37-.456.785-.897 1.216-1.229C4.257 3.27 4.756 3 5.28 3 6.23 3 7 3.77 7 4.72V7.1l.5-.357V1.5A.5.5 0 0 1 8 1m3.21 8.907a.5.5 0 1 0 .58-.814l-2.5-1.786A.5.5 0 0 0 9 7.214V8.33z"/>
</svg>X Ray</a>

 <a href="index.html" class="nav-item nav-link active mt-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-activity" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M6 2a.5.5 0 0 1 .47.33L10 12.036l1.53-4.208A.5.5 0 0 1 12 7.5h3.5a.5.5 0 0 1 0 1h-3.15l-1.88 5.17a.5.5 0 0 1-.94 0L6 3.964 4.47 8.171A.5.5 0 0 1 4 8.5H.5a.5.5 0 0 1 0-1h3.15l1.88-5.17A.5.5 0 0 1 6 2"/>
</svg> EKG</a>
                  
                    </div>
                </div>
            </nav>
        </div>
        <!-- Sidebar End -->


        <!-- Content Start -->
        <div class="content">
            <!-- Navbar Start -->
            <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
                <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
                    <h2 class="text-primary mb-0"><i class="fa fa-hashtag"></i></h2>
                </a>
                <a href="#" class="sidebar-toggler flex-shrink-0">
                    <i class="fa fa-bars"></i>
                </a>
                <form class="d-none d-md-flex ms-4">
                    <input class="form-control border-0" type="search" placeholder="Search">
                </form>
                <div class="navbar-nav align-items-center ms-auto">
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-envelope me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">Message</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="img/user.jpg" alt=""
                                        style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="img/user.jpg" alt=""
                                        style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="img/user.jpg" alt=""
                                        style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all message</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-bell me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">Notificatin</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">Profile updated</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">New user added</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">Password changed</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all notifications</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <img class="rounded-circle me-lg-2" src="" alt=""
                                style="width: 40px; height: 40px;">
                            <span class="d-none d-lg-inline-flex">Name</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">My Profile</a>
                            <a href="#" class="dropdown-item">Settings</a>
                            <a href="#" class="dropdown-item">Log Out</a>
                        </div>
                    </div>
                </div>
            </nav>
            <div class="container-fluid mt-5">
                <div class="row align-items-start w-100">
  <div class="col-10">
    <form class="row g-2">
      <div class="col-6 ms-4">
        <label class="visually-hidden" for="inlineFormInputGroupUsername">Barcode Here</label>
        <div class="input-group">
          <input type="text" class="form-control" id="searchid" placeholder="Barcode Here">
        </div>
      </div>

      <div class="col-auto">
        <button type="button" id="submit" onclick="submitSearch(event)" class="btn btn-primary">Search</button>
      </div>
    </form>
  </div>

  <div class="col-2 text-end">

    <button type="button" class="btn btn-primary" onclick="pickExcelOnce()">+</button>
  </div>
</div>

                <div class="container-fluid pt-4 px-4">
                    <div class="bg-light rounded h-100 p-4">
                        <h6 class="mb-4">Bordered Table</h6>
                        <table id="specimenlist" class="table table-bordered" style="font-family: kanit;">
                            <colgroup>
                                <col style="width: 5%;">
                                <col style="width: 20%;">
                                <col style="width: 60%;">
                                <col style="width: 15%;">
                            </colgroup>
                            <thead class="text-center" style="background-color:lightblue;">
                                <tr>
                                    <th scope="col" >#</th>
                                    <th scope="col" >ID</th>
                                    <th scope="col">‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th scope="col">specimen</th>

                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row" class="text-center" >1</th>
                                    <td class="text-center"></td>
                                    <td></td>
                                    <td class="text-center"></td>
                                  

                                </tr>
                               
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>

<div class="modal" id="showmodal" style="display: none;">
  <div class="modal-dialog" style="background-color: lightsteelblue;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Chest X-Ray</h5>
       
      </div>
      <div class="modal-body">
         <div class="row g-3"> 
            <div class="col-sm-4">
                 <span type="text" class="form-control" id="showid"></span>
            </div>
        <div class="col-sm-8">
                 <span type="text" class="form-control" id="showname"></span> 
            </div>
         </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closemodal()">Close</button>
        <button id="addspecimen" type="button" onclick=" addSpecimen(event)" class="btn btn-primary">Input</button>
      </div>
    </div>
  </div>
</div>


<script>
let fileHandle = null;
let workbook = null;
let cachedData = [];

function normalizeId(v){
  return String(v ?? "").trim().replace(/\s+/g,"").replace(/-/g,"").toUpperCase();
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g,m=>({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[m]));
}

// ================= SWEET ALERT HELPERS =================
function showLoading(title="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£..."){
  Swal.fire({
    title,
    allowOutsideClick:false,
    didOpen:()=>Swal.showLoading()
  });
}

function showSuccess(title,text){
  Swal.fire({
    icon:'success',
    title,
    html:`<b>${text}</b>`,
    timer:2000,
    timerProgressBar:true,
    showConfirmButton:false
  });
}

function showError(text){
  Swal.fire({
    icon:'error',
    title:'‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
    text
  });
}

function showWarning(text){
  Swal.fire({
    icon:'warning',
    title:'‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
    text
  });
}
// ======================================================


// ====== PICK EXCEL ======
async function pickExcelOnce(){
  try{
    if(!window.showOpenFilePicker){
      return showError("‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Chrome/Edge ‡∏ú‡πà‡∏≤‡∏ô https ‡∏´‡∏£‡∏∑‡∏≠ localhost");
    }

    [fileHandle] = await window.showOpenFilePicker({
      multiple:false,
      types:[{
        description:"Excel",
        accept:{
          "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],
          "application/vnd.ms-excel":[".xls"]
        }
      }]
    });

    showLoading("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå...");

    const file = await fileHandle.getFile();
    const buffer = await file.arrayBuffer();
    workbook = XLSX.read(buffer,{type:"array"});

    loadDataSheet();
    showSpecimen();

    Swal.close();
    showSuccess("‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",`‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${cachedData.length} ‡∏£‡∏≤‡∏¢ `);

  }catch(err){
    showError(err.message || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ");
  }
}


// ====== LOAD DATA SHEET ======
function loadDataSheet(){
  if(!workbook) return;

  const dataName = workbook.SheetNames.find(n=>n.trim().toLowerCase()==="data");
  if(!dataName){
    cachedData=[];
    return showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏µ‡∏ï‡∏ä‡∏∑‡πà‡∏≠ "Data"');
  }

  const ws = workbook.Sheets[dataName];
  const aoa = XLSX.utils.sheet_to_json(ws,{header:1,defval:""});
  const body = aoa.slice(1);

  cachedData = body
    .filter(r=>normalizeId(r?.[0])!=="")
    .map(r=>{
      const idRaw=r?.[0];
      const c=String(r?.[2]??"").trim();
      const d=String(r?.[3]??"").trim();
      const e=String(r?.[4]??"").trim();
      return{
        id:String(idRaw??"").trim(),
        idNorm:normalizeId(idRaw),
        name:[c,d,e].filter(Boolean).join(" ")
      };
    });
}


// ====== SEARCH ======
function submitSearch(e){
  if(e) e.preventDefault();

  if(!cachedData.length)
    return showWarning("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô");

  const key = normalizeId(document.getElementById("searchid")?.value);
  if(!key) return showWarning("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ID");

  const found = cachedData.find(x=>x.idNorm===key);

  if(found){
    document.getElementById("showid").textContent = found.id;
    document.getElementById("showname").textContent = found.name;
    openmodal();
  }else{
    showError("‡πÑ‡∏°‡πà‡∏û‡∏ö ID ‡∏ô‡∏µ‡πâ");
  }
}


// ====== ADD SPECIMEN ======
async function addSpecimen(e){
  if(e) e.preventDefault();

  try{

    if(!fileHandle||!workbook)
      return showWarning("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå");

    const id=document.getElementById("showid")?.textContent.trim();
    const name=document.getElementById("showname")?.textContent.trim();

    if(!id||!name)
      return showWarning("‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ID ‡πÉ‡∏´‡πâ‡∏û‡∏ö‡∏Å‡πà‡∏≠‡∏ô");

    const specName = workbook.SheetNames.find(n=>n.trim().toLowerCase()==="specimen");
    if(!specName)
      return showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏µ‡∏ï‡∏ä‡∏∑‡πà‡∏≠ "Specimen"');

    showLoading("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");

    const ws=workbook.Sheets[specName];
    const aoa=XLSX.utils.sheet_to_json(ws,{header:1,defval:""});

    let last=aoa.length-1;
    while(last>=0&&(aoa[last]||[]).every(v=>String(v).trim()==="")) last--;
    const nextRow=last+1;

    const row=aoa[nextRow]?[...aoa[nextRow]]:[];
    row[0]=id;
    row[1]=name;
    row[2]="X Ray";
    aoa[nextRow]=row;

    workbook.Sheets[specName]=XLSX.utils.aoa_to_sheet(aoa);

    const perm=await fileHandle.requestPermission({mode:"readwrite"});
    if(perm!=="granted"){
      Swal.close();
      return showError("‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå");
    }

    const writable=await fileHandle.createWritable();
    const out=XLSX.write(workbook,{bookType:"xlsx",type:"array"});
    await writable.write(out);
    await writable.close();

    Swal.close();
    showSuccess("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô Specimen ‡πÅ‡∏•‡πâ‡∏ß");

    showSpecimen();
    closemodal();

  }catch(err){
    Swal.close();
    showError(err.message || "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }
}


// ====== SHOW SPECIMEN ======
function showSpecimen(){
  if(!workbook) return;

  const specName=workbook.SheetNames.find(n=>n.trim().toLowerCase()==="specimen");
  if(!specName) return;

  const ws=workbook.Sheets[specName];
  const aoa=XLSX.utils.sheet_to_json(ws,{header:1,defval:""});
  const tbody=document.querySelector("#specimenlist tbody");
  if(!tbody) return;

  tbody.innerHTML="";
  let no=1;

  for(let i=1;i<aoa.length;i++){
    const r=aoa[i]||[];
    const colA=String(r[0]??"").trim();
    const colB=String(r[1]??"").trim();
    const colC=String(r[2]??"").trim();

    if(!colA&&!colB&&!colC) continue;
    if(colC.toLowerCase()!=="x ray") continue;

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <th class="text-center">${no}</th>
      <td  class="text-center">${escapeHtml(colA)}</td>
      <td>${escapeHtml(colB)}</td>
      <td  class="text-center">${escapeHtml(colC)}</td>
    `;
    tbody.appendChild(tr);
    no++;
  }
}

function openmodal(){
  document.getElementById("showmodal").style.display="block";
}

function closemodal(){
  document.getElementById("showmodal").style.display="none";
}
</script>

        <!-- Back to Top -->


        <!-- JavaScript Libraries -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="lib/chart/chart.min.js"></script>
        <script src="lib/easing/easing.min.js"></script>
        <script src="lib/waypoints/waypoints.min.js"></script>
        <script src="lib/owlcarousel/owl.carousel.min.js"></script>
        <script src="lib/tempusdominus/js/moment.min.js"></script>
        <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
        <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

        <!-- Template Javascript -->
        <script src="js/main.js"></script>
</body>

</html>
